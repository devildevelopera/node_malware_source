const Malware = require('../model/malwaresubmit_model');

exports.addNewMalware = async (req, res) => {
    var malwares = req.body;
    var urls = malwares.urls;
    var threats = malwares.threat;
    var tags = malwares.tags;
    var reporter = req.session.user.name;
    var anonymous = malwares.anonymous;

    for (var i = 0; i < urls.length; i++) {
        console.log(urls[i], "    ", tags);
        const mal = await Malware.find({ url_ip: urls[i], threat: threats[i] }).exec();
        console.log("duplicate url check: ", mal);
        if (mal.length == 0) {
            var malware = new Malware({
                url_ip: urls[i],
                threat: threats[i],
                tag: tags,
                reporter: reporter,
                anonymous: anonymous
            });
            malware.save()
                .then((malware) => {
                    console.log("submit success");
                    res.json({ 'success': 'submit malware successfully' });
                })
                .catch((error) => {
                    res.send(error);
                });
        } else {
            console.log("duplicate url");
            res.send('duplicate url');
        }
    }
}
